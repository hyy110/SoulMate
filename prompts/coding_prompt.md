# 编码 Agent Prompt

> 使用方式：在 Cursor 中开启新的 Agent 会话，将以下内容粘贴发送。每次新会话都使用这个 prompt。

---

## 你的角色 — 全栈编码 Agent

你正在继续一个长期自主开发任务。这是一个**全新的上下文窗口**，你对之前的会话没有任何记忆。

**核心原则：每次实现一个完整的用户故事，前端 + 后端 + 联调一起完成。**

### 步骤 1：了解当前状态（必须执行）

读取以下文件，了解项目全貌和当前进度：

1. `prompts/app_spec.txt` — 项目需求规格
2. `feature_list.json` — 功能列表和通过状态
3. `claude-progress.txt` — 之前的开发进度
4. `git log --oneline -20` — 最近的提交记录

统计当前进度：feature_list.json 中有多少个 `"passes": true`，多少个 `"passes": false`。

### 步骤 2：启动开发环境

启动前端和后端开发服务器：

**后端：**
```bash
cd backend
source venv/bin/activate       # Linux/Mac
# 或 .\venv\Scripts\Activate.ps1  # Windows
uvicorn app.main:app --reload --port 8000
```

**前端：**
```bash
cd frontend
npm run dev
```

确认两个服务都正常运行后再继续。如果依赖未安装，先运行 `init.sh`（Linux/Mac）或 `init.ps1`（Windows）。

### 步骤 3：回归验证（关键！）

上一个会话可能引入了 bug。选 1-2 个已标记为 `"passes": true` 的功能，手动验证：

- 后端：用 httpx 或 curl 调用 API，确认返回正确
- 前端：在浏览器中操作，确认页面和交互正常

**如果发现问题：**
- 立即将该功能标记回 `"passes": false`
- **先修复所有回归问题，再做新功能**
- 注意 UI bug：布局溢出、控制台报错、样式异常等

### 步骤 4：选择下一个用户故事

查看 `feature_list.json`，找到优先级最高的 `"passes": false` 功能，并**识别相关联的功能组**。

**关联规则：**
- 一个后端 API 功能 + 对应的前端页面功能 = 一个用户故事
- 例如："用户注册 API" + "用户注册页面" 应该一起实现
- 例如："创建角色 API" + "角色创建页面" 应该一起实现
- 纯后端功能（如数据库迁移）或纯前端功能（如样式调整）可以单独做

**本次会话目标：完成一个完整的用户故事（包含前后端），做好做完。**

### 步骤 5：全栈实现

按以下顺序实现：

#### 5.1 后端 API
1. 实现/完善后端路由、Schema、Service
2. 用 httpx 或测试脚本验证 API 正确性
3. 确认 Swagger 文档（/docs）中接口可用

#### 5.2 前端页面
1. 实现页面组件（UI + 交互逻辑）
2. 连接后端 API（使用 api/ 目录下的 client）
3. 接入状态管理（Zustand store）
4. 添加加载状态、错误处理、表单验证
5. 确保样式美观（Tailwind CSS），深色模式兼容

#### 5.3 前后端联调
1. 启动前后端，在浏览器中操作完整流程
2. 检查 Network 请求和响应是否正确
3. 检查控制台是否有错误
4. 验证边界情况（空数据、错误输入、网络异常提示）

### 步骤 6：端到端验证

**必须实际操作验证，不能只看代码：**

- 在浏览器中打开 http://localhost:5173
- 像真实用户一样走完整个流程
- 检查：页面渲染正确、API 调用成功、数据持久化、错误处理优雅
- 前端控制台无报错，后端无未处理异常

### 步骤 7：更新 feature_list.json

验证通过后，将本次完成的**所有相关功能**标记为通过：

```json
"passes": true
```

**可能同时标记多个功能**，例如后端 API + 前端页面 + 相关样式功能。

**绝对不能：** 删除功能、修改描述、修改测试步骤、合并功能、重排顺序。

### 步骤 8：提交 Git

```bash
git add .
git commit -m "实现[用户故事名称] - 前后端完整实现并验证

后端:
- [具体 API 变更]

前端:
- [具体页面/组件变更]

验证:
- [验证了哪些功能]
- feature_list.json: 标记 #X, #Y, #Z 为通过
"
```

### 步骤 9：更新进度

更新 `claude-progress.txt`：
- 本次完成了哪个用户故事
- 后端实现了什么
- 前端实现了什么
- 哪些功能通过了测试（列出编号）
- 发现并修复了哪些问题
- 下一个应该做的用户故事
- 当前进度（如 "25/210 tests passing"）

### 步骤 10：干净结束

1. 提交所有代码（git status 显示 clean）
2. claude-progress.txt 已更新
3. feature_list.json 中通过的功能已标记
4. 前后端都处于可运行状态
5. 无未提交的更改

---

## 重要提醒

- **开发方式：** 全栈实现，前端 + 后端一起做，不要只做半截
- **总目标：** 210 个功能全部通过的生产级应用
- **本次目标：** 完整实现一个用户故事（前端 + 后端 + 联调）
- **优先级：** 修复回归 > 完成用户故事 > 优化体验
- **质量标准：** API 正确、UI 美观、交互流畅、零控制台错误
- **前端要求：** 现代 UI、Tailwind 样式、响应式、深色模式、动画过渡

从步骤 1 开始。
